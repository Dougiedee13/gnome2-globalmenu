#How to install Global Menu Bar on Fedora 8?

= Ideas =

== Patching gtk2 ==
The patch's name is gtk2-aqd. The origin position is on aur linux's website and also can be find at ubuntu's forum. Patching gtk2 is necessary for global menu. However, the patch is more like a hack, so it is still faraway from entering the gtk2 official release.

== Setuping a menubar server ==
After patching gtk2, the gtk2 applications will put their menubar in a new toplevel window. on the lefttop of corner of the desktop. This is not exciting. So we need a menubar server to pick up these daunting menubars. So gnome2-globalmenu-applet is written.
It obsoletes the old gtk-macmenu-applet written by aqd.

= Installation Guide =
Here I list two ways to setup global menu bar for your gnome.
== By RPM ==

  * [http://gnome2-globalmenu.googlecode.com/files/gtk2-aqd-2.12.3-3.fc8.i386.rpm]

It obsolete gtk2 and provide gtk2, so the dependency tree will happy.
There is no way to have gtk2 and gtk2-aqd parallel installed. It also stops receiving further updates of gtk2 from fedora repositories.

Note: this patch contained in this rpm doen't work well with GtkTreeView. Mnemonic keys doesn't work inside a GtkTreeView. But no other known issues.

  * [http://gnome2-globalmenu.googlecode.com/files/gnome2-globalmenu-applet-0.2-1.fc8.i386.rpm]

After Installing the applet's rpm do followings:
  * Right click on your top panel
  * Choose add to panel
  * Type Global Menu.. until it shows up in the list
  * Click on Global Menu Applet
  * Press Add

Then the new launched gtk programs' menubar will display in the top panel, with the mnemonic keys working. No rebooting, No logging in and out.

== By SVN ==
{{{
svn checkout http://gnome2-globalmenu.googlecode.com/svn/trunk/ gnome2-globalmenu-read-only
}}}

There should be 3 directories under gnome2-globalmenu-read-only:
  * gtk2-aqd
  * gnome2-globalmenu-applet
  * gnome2-globalmenu-test
And one file
  * runtest.sh

=== gtk2-aqd ===
Suppose you have setup the rpm devel tree by `rpmdev-setuptree`. Do following steps to obtain a patched gtk2-aqd.spec and patched gtk2 at `gtk2-aqd/libs`.
{{{
env RPMDEVROOT={Your rpmdev tree root} make setup
env RPMDEVROOT={Your rpmdev tree root} make patch
}}}

It is possible to test whether gtk2-aqd works immediately after the above steps. 

{{{
env LD_LIBRARY_PATH={your gtk2-aqd directory}/libs gnomine
}}}
If gnomine appears and the menubar is located at the top left corner of desktop, Congratulations!

If not, check if you have `gnomine` installed and replaced `gnomine` with some other gtk applications.

Then build the rpm package (if you want.)

{{{
rpmbulid -ba gtk2-aqd.spec
}}}

Note: The package should be located at `RPMS/i386`.

=== gnome2-globalmenu-applet ===

The most trivial method to get a working executable is
{{{
cd gnome2-globalmenu-applet
configure
make
}}}
The executable locates at `gnome2-globalmenu-applet/src/gnome2-globalmenu-applet`
Try to invoke it by
{{{
src/gnome2-globalmenu-applet
}}}

If it opens a nerdy window and report some tracing informations, congratulations again! You didn't grab a rubbish version from svn!

Now we have `gtk2-aqd` and `gnome2-globalmenu-applet`, and your terminal is occupied by `gnome2-globalmenu-applet`.

Press `Ctrl-Z` to bring back your terminal
Make the applet run again by 
{{{
bg
}}}

Start your favorate gtk program again
{{{
env LD_LIBRARY_PATH={your gtk2-aqd directory}/libs gnomine
}}}
Now the menubar of gnomine will appears in the applet's window.
What? you only see a big big mine?

Try resizing the applet window and then refocus gnomine's window.

`gnome2-globalmenu-applet`, as the name suggests, can also be placed into a panel.
However, setting it up as a panel applet is a little bit convoluted.

Panel Applets are bonobo objects. `bonobo` is, kind of COM or ActiveX equivalence in Linux. Then you need to tell `bonobo-activation-server` that you have received a new bonobo object. 

First, you need a bonobo `.server` file. Fortunately aqd has already provided one for `gtk-macmenu-applet`, and I have already patched it for gnome2-macmenu-applet. You can find it in the root directory of `gnome2-globalmenu-applet`.

However, since I am not you and don't know where the `gnome2-globalmenu-applet` executable locates, you still need to open it and replace the string APP_LOCATION with the true location.
{{{
cat GNOME_GlobalMenuApplet.server.sample | sed "s;APP_LOCATION;"{Your gnome2-globalmenu-applet's dirname ONLY dirname!}";" > GNOME_GlobalMenuApplet.server
}}}

Secondly, you need to let `bonobo-activation-server` see the file. It is very weird that bonobo doesn't allow per user server file repository. So you have to 
{{{
su
cp GNOME_GlobalMenuApplet.server /usr/lib/bonobo/servers/
}}}

If you want a rpm, then because I know the executable will be installed at `/usr/libexec`, I have coded these step in `gnome2-globalmenu-applet.spec`:

{{{
make dist
cp *.tar.gz {Yor rpmdev tree root}/SOURCES
rpmbuild -ba gnome2-globalmenu-applet.spec
}}}

== Uninstall ==
If you've installed the rpm, but later find the global menubar boring / crashing your box / being criticized as plagiarizing OSX's interface and want to remove it.

  * Add/Remove Software,
  * Search `gtk2`
  * Uncheck `gtk2-aqd`
  * Check `gtk2`
  * Press Apply

Wait for `yum` to solve the dependencies. It should report no dependency problems.

All done!