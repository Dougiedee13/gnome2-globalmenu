#labels Phase-Deploy
#How to Build from scratch


= Introduction =
This article will help you to build gnome-globalmenu from a svn snapshot.
Currently, this guide only works for trunk (svn 1360+).

= Step 0: Prerequisites =

  * VALA = [http://download.gnome.org/sources/vala/0.3/vala-0.3.5.tar.bz2 0.3.5] is a must for building from svn. Building from a released tarball doesn't need it.
    * lastest trunk build of vala should work, though not tested.
  * and development headers for the libraries
    * dbus-glib
    * GTK
    * libpanelapplet (for GlobalMenu.PanelApplet)

= Step 1: Obtain the Source =

{{{
svn checkout http://gnome2-globalmenu.googlecode.com/svn/trunk/ gnome-globalmenu
}}}


= Step 2: Compile the Source =
{{{
cd gnome-globalmenu
./autogen.sh --prefix=/usr
./configure --enable-gtk-doc
make
}}}

For most linux flavors I know, --prefix=/usr is more preferable than --prefix=/usr/local.
Other things you can disable are
{{{
# --enable-xfce-plugin=[yes]|no  ; not implemented yet
--enable-gnome-applet=[yes]|no
--enable-maintainer-mode=[yes]|no ;
# --enalbe-gtk-doc=[no]|yes  ; not implemented yet;
}}}

Several libraries are built:
  * `libgnomenugtk`: the GTK side of global menu, provides bindings into GTK and dynamic patches;
  * `libgnomenu`: the DBus interfaces, and GTK widgets to view a global menu;
  * `libgmarkupdoc-base`: a document model for GMarkup texts;
  * `libgmarkupdoc-dbus`: remotely access the GMarkup document model via DBus;
  * `libgmarkupdoc-named`: a GTK TreeModel for a GMarkup document model;

Ensure libgnomenu is loaded as a Gtk module by 
{{{
export GTK_MODULES=libgnomenugtk
}}}
A good place to do this is in `~/.profile`, `~/.bash_profile`, `or ~/.gnomerc`, it depends on the flavor of linux.

If you are debugging, some [http://developer.apple.com/documentation/developertools/glibtool/libtool_3.html#SEC11 libtool tricks] can help 
{{{
cd libgnomenugtk;
env GTK_MODULES=libgnomenugtk libtool gdb [any application]
}}}

Also an environment variable is helpful
{{{
export GNOMENU_FUN=1
}}}
the variable tells `libgnomenugtk` to open a Gtk TreeView for all menus in the application you start.

Several binaries are also built:
  * `GlobalMenu.PanelApplet` is the panel applet for gnome panel.
    * See [http://www.davyd.id.au/articles/debugging-gnome-applets.shtml David's tricks] for debugging a panel applet.
  * `org.gnome.GlobalMenu.Server` is the server for window management.
    * --kill for killing any existed instance.
  * `gnomenu-navigator` is a tool to inspect any menu bar on the system.


To install
{{{
su -c 'make install'
}}}


= Step 3: Packaging =
The current preferred package name is `gnome-globalmenu`; and for RPM there is an example spec file, `gnome-globalmenu.spec.tmpl`, and a script to build the RPM packages,
{{{
./rpm
the subversion version is 1360:1378M
enter the desired version
<you type>1378
enter the release number
<you type enter>
}}}
and the packages will be built under `~/rpmbuild`.
Modify the script `./rpm` if needed.

Always make sure you have {SVN VERSION} in package naming, to avoid future conflictions.


= Step 4: Remove =

{{{
make uninstall
}}}

= Troubleshooting =
==In General==
Please report to our project's mail list the detail of the trouble which traps you . We will try to help. the address of the mail list is googlegroups.com: gnome-globalmenu . reverse the order and replace : with @. 

SVN traffic also goes into the groups.