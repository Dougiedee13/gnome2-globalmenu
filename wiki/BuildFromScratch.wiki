#labels Phase-Deploy
#How to Build from scratch

= Introduction =
This article will help you to build gnome2-globalmenu from a svn snapshot.
Currently, this guide only works for tags/0.3_323 and later versions.

= Step 1: Obtain the Source =
Suppose you want to obtain the snapshot for version 0.3 svn 323,

{{{
export SUBDIR=0.3_323
svn checkout http://gnome2-globalmenu.googlecode.com/tags/${SUBDIR} gnome2-globalmenu-${SUBDIR}
}}}
Then you are done. 

= Step 2: Compile the Source =
{{{
cd gnome2-globalmenu-${SUBDIR}
}}}
== 2.1 Compile the gtk2-aqd patch ==
*Notice: FOLLOWING THESE STEPS WILL REPLACE THE OLD GTK PACKAGE SHIPPED WITH YOUR DISTRIBUTION. IT IS POSSIBLE TO LOSE YOUR GUI.*
First, change your working directory,
{{{
cd gtk2-aqd
}}}
Next, obtain the source code for gtk, and extract it into `gtk+-aqd`. The detail steps depend on your preference and your platform. On my box (where I have all the source tarballs in ~/sources/SOURCES), I can simple do
{{{
mkdir gtk+-aqd
cp ~/sources/SOURCES/gtk+-2.12.3.tar.bz2 .
tar --strip-components=1 -xjvf gtk+-2.12.3.tar.bz2 -C gtk+-aqd
}}}
HINT: If your tar is very old, you may need to use `strip-path` instead of `strip-componets`.
Maybe you'll need to install some source code packages to obtain the tarball, or try to download one from [ftp://ftp.gtk.org/pub/gtk/v2.10/].
OK, let's suppose you have successfully set up the source code of gtk. The next essential setup is to apply the patch.
{{{
patch -p0 < patch.diff
cp gtkmenuembed-x11.h gtk+-aqd/gtk
}}}
If no error is reported, then you can configure `gtk` and compile. If error happens,
see Troubleshooting section of this article.
{{{
cd gtk+-aqd
./configure --prefix=/usr/local --with-gdk-target=x11
make
}}}
If you encounter problems, refer to Troubleshooting section.
If no error occurs, the next step is
{{{
su -c 'make install'
}}}
If no error occurs, your gtk is already patched. Try to start a simple gtk program in a console and you will see a lot of debugging messages. e.g
{{{
Gtk-Message: Pass to futher handlers, not a MenuBar message
Gtk-Message: XClientMessage received
Gtk-Message: Pass to futher handlers, not a MenuBar message
Gtk-Message: XClientMessage received
Gtk-Message: Pass to futher handlers, not a MenuBar message
Gtk-Message: XClientMessage received
Gtk-Message: Pass to futher handlers, not a MenuBar message
Gtk-Message: XClientMessage received
Gtk-Message: Pass to futher handlers, not a MenuBar message
Gtk-Message: XClientMessage received
Gtk-Message: Pass to futher handlers, not a MenuBar message
Gtk-Message: gtk_menu_bar_paint invoked
Gtk-Message: gtk_menu_bar_paint invoked
Gtk-Message: gtk_menu_bar_paint invoked
Gtk-Message: gtk_menu_bar_paint invoked
Gtk-Message: gtk_menu_bar_paint invoked
}}}
If you can not see these messages, see Troubleshooting section
{{{
cd ..
}}}
== 2.2 Compile the applet ==
{{{
cd gnome2-globalmenu-applet
./autogen.sh --prefix=/usr/local # or whatever you prefer.
make
su -c 'make install'
}}}
Then you are done. Add it to the panel and have fun. The name of the applet is Global Menubar .
{{{
cd ..
}}}

= Step 3: Packaging =
Dear user/hacker, 
If you manage to pass all these steps, and there is no package for your distribution/platform, I will strongly encourage you to build two packages for others who also use this platform. The suggested package name is:
||package name || content || note||
||`gtk2-aqd-${SUBDIR}-${YOURGTKVERSION}`|| gtk || provides gtk2 - ${YOURGTKVERSION}, obsoletes gtk2 - ${YOURGTKVERSION} ||
||`gnome-globalmenu-${SUBDIR}` || the applet || ||
= Step 4: Remove =
== 4.1 Remove the applet ==
{{{
cd gnome2-globalmenu-applet
su -c 'make uninstall'
cd ..
}}}
== Remove gtk2-aqd ==
I'll suggest you do this under a tty instead of under a terminal window.
=== One possible approach ===
Safer but dirty.
{{{
cd gtk2-aqd
tar --strip-components=1 -xjvf gtk+-2.12.3.tar.bz2 -C gtk+-aqd
cd gtk+-aqd
./configure --prefix=/usr/local --with-gdk-target=x11
make
su -c 'make install'
}}}
=== Another possible approach ===
Cleaner but dangrous. I'll (personally) prefer this approach. 
First of all fetch the package file of gtk from your distribution's repository. Put it in `gtk2-aqd` directory. DO NOT IGNORE THIS STEP.
{{{
cd gtk2-aqd
cd gtk+-aqd
su -c 'make uninstall'
cd ..
}}}
At this moment you don't have any gtk installation in your computer. Almost every newly launching GUI application will fail. The running ones will be ok though, thanks to the designation of linux kernel.

Anyway, use your commandline package manager to install the gtk package, eg,
{{{
su -c 'rpm -i gtk*.rpm'
}}}
Done.
= Troubleshooting =
==I cannot apply the patch==
Which version of gtk are you patching against? It is known to work on 2.12.1 and 2.12.3
If the source code of gtk you obtained has already been patched, the patch may also fail to apply. 
==I cannot see the debugging messages==
Are you sure the directory in the `configure` location is the correct directory for your system's path? try
{{{
locate libgtk-x11-2.0.so
}}}
and figure out the correct `prefix`. Also, if you are using a distribution with strong packaging system(rpm or deb), refer to the gtk package's spec(description) file also will help you to figure it out.
==I can not see the applet in the add applet dialog of gnome panel==
How is your bonobo-activation configure? If it is in a very weird location, this will happen. Try to find out a directory with many `.server` files, edit `/usr/local/share/doc/gnome2-globalmenu-applet/GNOME_GlobalMenuApplet.server.sample`, and put it there with an extension `.server`.
==In General==
Please report to our project's mail list the detail of the trouble which traps you . We will try to help. the address of the mail list is googlegroups.com: gnome-globalmenu . reverse the order and replace : with @. 

SVN traffic also goes into the groups and we don't want to hide your voice into junk mail.