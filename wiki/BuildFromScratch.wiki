#labels Phase-Deploy,Featured,installation
#How to Build from the source.

= Introduction =
This article will help you to build gnome-globalmenu from a svn snapshot.
Currently, this guide only works for trunk (svn 1450+).
The latest known working revision is svn ??. 

= Step 0: Prerequisites =

  * VALA = [http://download.gnome.org/sources/vala/0.5/vala-0.5.1.tar.bz2 0.5.1] is a must for building from svn. Building from a released tarball doesn't need it.
    * lastest trunk build of vala should work, though not tested.
    * [http://code.google.com/p/gnome2-globalmenu/downloads/list?can=2&q=vala&colspec=Filename+Summary+Uploaded+Size+DownloadCount SRPM]
  * and development headers for the dependencies
    * gio-1.0
    * gio-unix-1.0
    * libwnck-1.0
    * gtk+-2.0
    * libpanelapplet-1.0 (for GlobalMenu.PanelApplet)
  * libtool 2.2.6 is known to have problems and not solved yet. libtool 1.5.24 is fine.

= Step 1: Obtain the Source =

{{{
svn checkout http://gnome2-globalmenu.googlecode.com/svn/trunk/ gnome-globalmenu
}}}


= Step 2: Compile the Source =

== configure ==
{{{
cd gnome-globalmenu
./autogen.sh --prefix=/usr
make
}}}

For most linux flavors I know, `--prefix=/usr` is more preferable than `--prefix=/usr/local`.
Other things you can change are (useful for packagers)
{{{
--disable-tests # disable building the tests (they take some time)
--disable-schemas-install # disable installing the gconf schemas
}}}
== components ==

The gtk plugin module, `libglobalmenu-gnome`, and the applet, `GlobalMenu.PanelApplet` together forms an implementation of GlobalMenuSpecification.

=== module ===

`libglobalmenu-gnome` is a GTK plugin module that makes GTK aware of the global menu by dynamic patching. The library is built under `gtk-modules/globalmenu/`.

At this stage you can set the environment to test the global menu:
{{{
export GTK_MODULES=globalmenu-gnome
}}}
The environment variable is not recommended because it is not integrated into the gnome stack. After installation you can enable the module with a gconf key, as mentioned later.

If you are debugging, some [http://developer.apple.com/documentation/developertools/glibtool/libtool_3.html#SEC11 libtool tricks] can help 
{{{
cd gtk-modules/globalmenu;
libtool gdb [any application]
}}}

Environment variable `GLOBALMENU_GNOME_AGRS` contains the gnu style arguments of the gtk plugin module library
{{{
GLOBALMENU_GNOME_ARGS=
--verbose
--disable
--log-file="filename"
}}}

The magic environment variable `GTK_MENUBAR_NO_MAC` can be specified for the module to ignore the applications.
{{{
export GTK_MENUBAR_NO_MAC=[prgname list, eg: "gedit gnome-settings-daemon"]
}}}
If some application doesn't work well with the plugin, please file an
[http://code.google.com/p/gnome2-globalmenu/issues/list issue].

=== applet ===

The gnome-panel applet is built at `applet/GlobalMenu.PanelApplet`.
  * See [http://www.davyd.id.au/articles/debugging-gnome-applets.shtml David's tricks] for debugging a panel applet.
  * `--verbose` for many debug messages.

The applet is built with `libgnomenu`, which contains the GTK widgets representaion of Global Menu.

= Step 3: Install =

To install
{{{
su -c 'make install'
}}}

Ensure `libglobalmenu-gnome` is loaded as a Gtk module by setting the gconf key
{{{
apps/gnome-settings-daemon/gtk-modules/globalmenu-gnome
}}}
Notice that loading and unloading the module on the fly is yet experimental. Random crashes do occur. So please immediately restart your gnome session after changing this key.

Also remember to add the applet to your panel.

= Step 4: Packaging =

== rpm ==
Making the rpm is easy. At the toplevel source tree:

{{{
make rpm
}}}

Then a vim will popup. with the spec file, modify the version info, append any change logs, then save the file.

A rpm package will be ready in `~/rpmbuild/RPMS/`, if rpmbuild is set up properly.

== other ==
Because some of the c source code is built from vala code, prepend a `make` before `make dist` to avoid strange building problems.


= Step 5: Remove =

{{{
make uninstall
}}}

= Troubleshooting =
==In General==
Please report to our project's mail list the detail of the trouble which traps you . We will try to help. the address of the mail list is `googlegroups.com: gnome-globalmenu` . reverse the order and replace `:` with `@`. 

SVN traffic also goes into the groups.